solana-defi-hackathon


Контракт index-maker

Позволяет клиенту создавать новые индексы, записывает переданные данные в аккаунт, связанный с индексом.

Исходный код контракта: https://github.com/p2p-org/solana-defi-hackathon/tree/main/index-maker

Пример работы с контрактом: https://github.com/p2p-org/solana-defi-hackathon/blob/main/index-maker/tests/functional.rs

Контракт имеет единственную инструкцию CreateIndex, в которой указываются:
Целочисленная величина комиссии
Формула расчета
Набор токенов
Текстовое описание индекса

При формировании сообщения с инструкцией, также необходимо указать аккаунты:
[signer] - Аккаунт инициализатора, он же будет владельцем индекса
[writable] - Предварительно созданный аккаунт для хранения данных индекса, владельцем должна быть назначена программа index-maker
[] - Rent sysvar аккаунт

Формула задается последовательностью байтовых команд, обозначающих операции и операнды. Возможные значения команд приведены в таблице ниже:

| Имя | Формат |
| ------------- |:-------------:|
| Number | 9 байт, первый содержит число 0, остальные 8 кодируют число float в LE | 
| Plus |  1 байт, содержит число 1 | 
| Minus | 1 байт, содержит число 2 |
| Mul |  1 байт, содержит число 3 |
| Div | 1 байт, содержит число 4 | 
| Pow | 1 байт, содержит число 5 |
| OpenPar | 1 байт, содержит число 6 |
| ClosePar | 1 байт, содержит число 7 | 
| Var | 5 байт, первый содержит число 8, остальные 4 кодируют целочисленный индекс переменной в LE | 
| Indicator | 9 байт, первый содержит число 9, следующие 4 кодируют целочисленный идентификатор индикатора в LE, остальные 4 кодируют целочисленный порядковый номер токена из списка токенов в LE, начиная с нуля | 

Например, если Indicator c ID = 0 обозначает цену токена, Indicator с ID = 1 обозначает количество токенов в обращении, а величина D = 0.123, то формула расчета DFG для семи токенов примет следующий вид:

[OpenPar, Indicator(0, 0), Mul, Indicator(1, 0), Plus, Indicator(0, 1), Mul, Indicator(1, 1), Plus, Indicator(0, 2), Mul, Indicator(1, 2), Plus, Indicator(0, 3), Mul, Indicator(1, 3), Plus, Indicator(0, 4), Mul, Indicator(1, 4), Plus, Indicator(0, 5), Mul, Indicator(1, 5), Plus, Indicator(0, 6), Mul, Indicator(1, 6), ClosePar, Div, Number(0.123)]
